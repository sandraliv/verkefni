<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="is">
<head>
    <meta charset="UTF-8">
    <title>Recipes</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<h1 th:if="${user}" th:text="'Hello, ' + ${user.name}">Hello, User</h1>
<p th:if="${message}" th:text="${message}"></p>
<h2>Recipes:</h2>

<ul id="recipe-list">
    <li th:each="recipe : ${recipes}">
        <h3 th:text="${recipe.title}">Recipe Title</h3>
        <p th:text="${recipe.description}">Recipe Description</p>
        <p><strong>Date Added:</strong>
            <span th:text="${recipe.formattedDate}">Date Added</span>
        </p>

        <div class="rating">
            <div class="stars">
                <span th:each="i : ${#numbers.sequence(1, 5)}"
                      th:class="${i <= recipe.averageRating.intValue() ? 'star-filled' :
                                (i - 0.5 <= recipe.averageRating.doubleValue() && i > recipe.averageRating.doubleValue() ? 'star-half-filled' : 'star-empty')}">
                    â˜…
                </span>
            </div>
            <span class="rating-count" th:text="${recipe.ratingCount == 0 ? 'No ratings yet' : '(' + recipe.ratingCount + ')'}"></span>
        </div>

        <!-- Ingredients Table -->
        <table>
            <tr>
                <th>Ingredient</th>
                <th>Quantity</th>
            </tr>
            <tr th:each="ingredient : ${recipe.ingredients}">
                <td th:text="${#strings.replace(ingredient.key, '_', ' ')}">Ingredient Name</td>
                <td th:text="${ingredient.value}">Ingredient Quantity</td>
            </tr>
        </table>

        <!-- Display Recipe Categories (with spaces between words and proper case) -->
        <p><strong>Categories:</strong>
            <span th:each="category : ${recipe.categories}"
                  th:text="${#strings.capitalize(#strings.replace(category, '_', ' '))}">Category Name</span>
        </p>

        <!-- Display Recipe Tags -->
        <p><strong>Tags:</strong>
            <span th:each="tag, iterStat : ${recipe.tags}" th:text="${tag}"
                  th:if="${iterStat.index < recipe.tags.size() - 1}">, </span>
        </p>

        <img th:src="${recipe.image_url}" alt="Recipe Image">

        <form th:action="@{/allrecipes/{id}/addAsFav(id=${recipe.id})}" method="post">
            <button type="submit">Add to Favorites</button>
        </form>
    </li>
</ul>

</body>
</html>
